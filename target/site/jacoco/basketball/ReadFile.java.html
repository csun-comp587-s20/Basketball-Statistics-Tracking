<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReadFile.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">basketball</a> &gt; <a href="index.source.html" class="el_package">basketball</a> &gt; <span class="el_source">ReadFile.java</span></div><h1>ReadFile.java</h1><pre class="source lang-java linenums">// Alex Eidt
// Basketball Statistics Tracking Program
// ReadFile Class
// Reads in an input .BBALL file and creates all necessary components that allow the user to resume tracking.
package basketball;
import java.io.*;
import java.util.*;
import java.util.List;
import java.util.regex.*;

public class ReadFile extends BasketballMain {

	private static final long serialVersionUID = 1L;
	private static final int UNDO_LENGTH = 8;
	
	private Scanner scanFile;				// Scanner for file
	private Scanner getLines;				// Scanner to get number of lines in the file
	private List&lt;String[]&gt; undoFile;        // List of undo's listed at bottom of game file
	private List&lt;Player&gt; players;		    // List of players from game file 
	private Queue&lt;String&gt; fileData;			// All the lines in the scanned file
	private GameSettings SETTINGS;			// Settings used for coloring/formatting of program
	private String version;                 // Current Version of the Program
	private int numPlayers;					// The number of players being scanned in
	
	// Post: Constructs a ReadFile given the 'fileName' of the input file and the 'settings'
	//       used to format the program.
	@SuppressWarnings(&quot;static-access&quot;)
<span class="nc" id="L28">	public ReadFile(String fileName, GameSettings settings) {</span>
		try {
<span class="nc" id="L30">			File file = new File(super.FILE_PATH + &quot;\\&quot; + GAMEFILESFOLDER + &quot;\\&quot; + fileName);</span>
<span class="nc" id="L31">			this.scanFile = new Scanner(file);</span>
<span class="nc" id="L32">			this.getLines = new Scanner(file);</span>
<span class="nc" id="L33">		} catch (Exception e) {</span>
<span class="nc" id="L34">			System.out.println(&quot;Error, file not found&quot;);</span>
<span class="nc" id="L35">			System.out.println(e.getMessage());</span>
<span class="nc" id="L36">		}</span>
<span class="nc bnc" id="L37" title="All 2 branches missed.">		if (!this.scanFile.hasNextLine()) {</span>
<span class="nc" id="L38">			System.out.println(fileName + &quot; is empty.&quot;);</span>
<span class="nc" id="L39">			throw new IllegalArgumentException();</span>
		}
<span class="nc" id="L41">		this.fileData = new LinkedList&lt;String&gt;();</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">		while (this.getLines.hasNextLine()) {</span>
<span class="nc" id="L43">			this.fileData.add(this.getLines.nextLine());</span>
		}
<span class="nc" id="L45">		this.getLines.close();</span>
<span class="nc" id="L46">    	Pattern playerPattern = Pattern.compile(&quot;Player\\s.+_.+&quot;);</span>
    	// Count the number of players in the input file
<span class="nc bnc" id="L48" title="All 2 branches missed.">    	for (String line : this.fileData) {</span>
<span class="nc" id="L49">    		Matcher playerMatch = playerPattern.matcher(line);</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">			if (playerMatch.find()) {</span>
<span class="nc" id="L51">				this.numPlayers++;</span>
			}	
<span class="nc" id="L53">    	}</span>
<span class="nc" id="L54">		this.undoFile = new ArrayList&lt;String[]&gt;();</span>
<span class="nc" id="L55">		this.players = new ArrayList&lt;Player&gt;(this.numPlayers);</span>
<span class="nc" id="L56">		this.SETTINGS = settings;</span>
<span class="nc" id="L57">		this.version = this.fileData.remove();</span>
<span class="nc" id="L58">	}</span>
	
	// Post: Returns true if the game being scanned in is over.
	//       Returns false otherwise or if the file is corrupted.
	public boolean isGameOver() {
		try {
<span class="nc bnc" id="L64" title="All 2 branches missed.">			return Integer.valueOf(this.version.split(&quot;_&quot;)[CURRENT_PERIOD]) == END_OF_GAME;</span>
<span class="nc" id="L65">		} catch (Exception e) {</span>
<span class="nc" id="L66">			return false;</span>
		}
	}
	
	// Post: Returns true if the file is ready to be read in by the system (i.e. is not corrupted).
	//       Returns false otherwise.
	public boolean checkFile() {
<span class="nc bnc" id="L73" title="All 2 branches missed.">		for (int i = 0; i &lt; this.numPlayers; i++) {</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">			for (int j = 0; j &lt; STATISTIC_ABBREVIATIONS.length + 1; j++) {</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">				if (j == STATISTIC_ABBREVIATIONS.length) {</span>
<span class="nc" id="L76">					this.fileData.remove();</span>
				} else {
<span class="nc" id="L78">					String stat = STATISTIC_ABBREVIATIONS[j];</span>
<span class="nc" id="L79">					String gameData = this.fileData.remove();</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">					if (!gameData.contains(stat)) {</span>
<span class="nc" id="L81">						return false;</span>
					}
				}
			}	
		}
<span class="nc" id="L86">		int undo = 0;</span>
<span class="nc" id="L87">		int totalUndo = this.fileData.size();</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">		while (!this.fileData.isEmpty()) {</span>
<span class="nc" id="L89">			String data = this.fileData.remove();</span>
<span class="nc" id="L90">			String[] checkData = data.split(&quot;,&quot;);</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">			if (checkData(checkData) &amp;&amp; checkData.length == UNDO_LENGTH) {</span>
<span class="nc" id="L92">				undo++;</span>
			}
<span class="nc" id="L94">		}</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">		return undo == totalUndo;</span>
	}
	
	// Post: Returns true if all elements in 'data' are correct.
	//       Returns false otherwise.
	private boolean checkData(String[] data) {
<span class="nc" id="L101">		String[] patterns = {&quot;[A-Za-z\\s\\.]+&quot;, &quot;[A-Za-z0-9\\s]+&quot;, &quot;(OT[0-9])|([0-9][a-z]+)&quot;};</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">		for (int i = 0; i &lt; data.length; i++) {</span>
			Pattern pattern;
			Matcher match;
<span class="nc bnc" id="L105" title="All 2 branches missed.">			if (i &lt;= 6) {</span>
<span class="nc" id="L106">				pattern = Pattern.compile(patterns[0]);</span>
<span class="nc" id="L107">				match = pattern.matcher(data[i]);</span>
			} else {
<span class="nc" id="L109">				pattern = Pattern.compile(patterns[i - 6]);</span>
<span class="nc" id="L110">				match = pattern.matcher(data[i]);</span>
			}
<span class="nc bnc" id="L112" title="All 2 branches missed.">			if (!match.find()) {</span>
<span class="nc" id="L113">				return false;</span>
			}
		}
<span class="nc" id="L116">		return true;</span>
	}

	// Indices of game data in 'boxscoreData'.
	private static final int NUM_STARTERS = 0;
	private static final int PERSONAL_FOULS = 1;
	private static final int TECHNICAL_FOULS = 2;
	private static final int FLAGRANT_I = 3;
	private static final int FLAGRANT_II = 4;
	private static final int PERIOD_TYPE = 5;
	private static final int GAME_LENGTH = 6;
	private static final int TIME_REMAINING = 7;
	private static final int OVERTIMES = 8;
	private static final int CURRENT_PERIOD = 9;
	private static final int TIMEOUTS = 10;
	private static final String PERIOD_TYPE_ID = &quot;false&quot;;
	
	// Post: Returns all the data stored in the game file.
	public Object[] getFileData() {
<span class="nc" id="L135">		return new Object[] {getGameSettingsData(),</span>
<span class="nc" id="L136">				             getPlayers(),</span>
<span class="nc" id="L137">				             getUndoArray()};</span>
		}
	
	// Post: Returns the GameSettings used in the game that is being scanned in from the file.
	private GameSettings getGameSettingsData() {
<span class="nc" id="L142">		String[] boxscoreData = this.scanFile.nextLine().split(&quot;_&quot;);</span>
<span class="nc" id="L143">		GameSettings data = new GameSettings();</span>
<span class="nc" id="L144">		data.setSetting(Integer.valueOf(boxscoreData[NUM_STARTERS]), Setting.NUMBER_OF_STARTERS);</span>
<span class="nc" id="L145">		data.setSetting(Integer.valueOf(boxscoreData[PERSONAL_FOULS]), Setting.PERSONAL_FOULS);</span>
<span class="nc" id="L146">		data.setSetting(Integer.valueOf(boxscoreData[TECHNICAL_FOULS]), Setting.TECHNICAL_FOULS);</span>
<span class="nc" id="L147">		data.setSetting(Integer.valueOf(boxscoreData[FLAGRANT_I]), Setting.FLAGRANT_I);</span>
<span class="nc" id="L148">		data.setSetting(Integer.valueOf(boxscoreData[FLAGRANT_II]), Setting.FLAGRANT_II);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">		data.setSetting(!boxscoreData[PERIOD_TYPE].equals(PERIOD_TYPE_ID), Setting.PERIOD_TYPE);</span>
<span class="nc" id="L150">		data.setSetting(Double.valueOf(boxscoreData[GAME_LENGTH]), Setting.GAME_LENGTH);</span>
<span class="nc" id="L151">		data.setSetting((Double.valueOf(boxscoreData[TIME_REMAINING])), Setting.TIME_REMAINING);</span>
<span class="nc" id="L152">		data.setSetting(Double.valueOf(boxscoreData[OVERTIMES]), Setting.OVERTIME_LENGTH);</span>
<span class="nc" id="L153">		data.setSetting(Integer.valueOf(boxscoreData[CURRENT_PERIOD]), Setting.CURRENT_PERIOD);</span>
<span class="nc" id="L154">		data.setSetting(Integer.valueOf(boxscoreData[TIMEOUTS]), Setting.TIMEOUTS);</span>
<span class="nc" id="L155">		data.setSetting(this.SETTINGS.getSetting(Setting.BACKGROUND_COLOR), Setting.BACKGROUND_COLOR);</span>
<span class="nc" id="L156">		data.setSetting(this.SETTINGS.getSetting(Setting.FONT_COLOR), Setting.FONT_COLOR);</span>
<span class="nc" id="L157">		data.setSetting(this.SETTINGS.getSetting(Setting.TEXT_BORDER_COLOR), Setting.TEXT_BORDER_COLOR);</span>
<span class="nc" id="L158">		data.setSetting(this.SETTINGS.getSetting(Setting.FONT_TYPE), Setting.FONT_TYPE);</span>
<span class="nc" id="L159">		return data;</span>
	}
	
	// Post: Returns a list of the players in the input file with all their statistical data.
	private List&lt;Player&gt; getPlayers() {
		// Add all statistics for each player as they appear in the input file
<span class="nc bnc" id="L165" title="All 2 branches missed.">		for (int i = 0; i &lt; this.numPlayers; i++) {</span>
<span class="nc" id="L166">			Player player = new Player(&quot;&quot;);</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">			for (int j = 0; j &lt; STATISTIC_ABBREVIATIONS.length + 1; j++) {</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">				if (this.scanFile.hasNextLine()) {</span>
<span class="nc" id="L169">					String line = this.scanFile.nextLine();</span>
<span class="nc" id="L170">					Scanner lineScan = new Scanner(line);</span>
<span class="nc" id="L171">					String columnName = lineScan.next();</span>
<span class="nc" id="L172">					String stat = lineScan.next();</span>
<span class="nc" id="L173">					player.setStat(columnName, stat);	</span>
<span class="nc" id="L174">					lineScan.close();</span>
				}
			}
<span class="nc" id="L177">			this.players.add(player);</span>
		}		
		// Scan in all undo's into the 'undoFile' list
<span class="nc bnc" id="L180" title="All 2 branches missed.">		while (this.scanFile.hasNextLine()) {</span>
<span class="nc" id="L181">			String[] undoLine = this.scanFile.nextLine().split(&quot;, &quot;);</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">			if (!undoLine[undoLine.length - 1].equals(&quot;DONE&quot;)) {</span>
<span class="nc" id="L183">				this.undoFile.add(undoLine);</span>
			}
<span class="nc" id="L185">		}		</span>
<span class="nc" id="L186">		this.scanFile.close();	</span>
<span class="nc" id="L187">		return this.players;</span>
	}
	
	// Indices of data in each String[] in 'undoFile'.
	private static final int PLAYER_NAME = 0;
	private static final int PLAYER_LAST_NAME = 1;
	private static final int PLAYER_DISPLAY_NAME = 2;
	private static final int ASSISTPLAYER_NAME = 3;
	private static final int ASSISTPLAYER_LAST_NAME = 4;
	private static final int ASSISTPLAYER_DISPLAY_NAME = 5;
	private static final int STATISTIC = 6;
	private static final int TIME = 7;
	
	// Post: Returns a list of every undo stored in the input file.
	private List&lt;Undo&gt; getUndoArray() {
<span class="nc" id="L202">		List&lt;Undo&gt; undoArray = new ArrayList&lt;Undo&gt;();</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">		for (String[] line : this.undoFile) {</span>
<span class="nc" id="L204">			Undo undo = null;</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">			for (Player player : this.players) {</span>
				// Match player with undo
<span class="nc bnc" id="L207" title="All 2 branches missed.">				boolean match = player.getName().equals(line[PLAYER_NAME]) </span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">						        &amp;&amp; player.getLastName().equals(line[PLAYER_LAST_NAME]) </span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">						        &amp;&amp; player.getDisplayName().equals(line[PLAYER_DISPLAY_NAME]);</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">				if (match) {</span>
<span class="nc" id="L211">					undo = new Undo(player, line[STATISTIC], line[TIME]);</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">					for (Player astPlayer : this.players) {</span>
						// Match AssistPlayer with undo
<span class="nc bnc" id="L214" title="All 2 branches missed.">						boolean matchAst = astPlayer.getName().equals(line[ASSISTPLAYER_NAME]) </span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">								           &amp;&amp; astPlayer.getLastName().equals(line[ASSISTPLAYER_LAST_NAME]) </span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">								           &amp;&amp; astPlayer.getDisplayName().equals(line[ASSISTPLAYER_DISPLAY_NAME]);</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">						if (matchAst) {</span>
<span class="nc" id="L218">							undo.setAstPlayer(astPlayer);</span>
<span class="nc" id="L219">							break;</span>
						}
<span class="nc" id="L221">					}</span>
<span class="nc" id="L222">					break;</span>
				}
<span class="nc" id="L224">			}</span>
<span class="nc" id="L225">			undoArray.add(undo);</span>
<span class="nc" id="L226">		}</span>
<span class="nc" id="L227">		return undoArray;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>